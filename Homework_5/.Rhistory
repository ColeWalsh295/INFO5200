set.seed(123)
library(tidyverse)
# Set sample size
n = 500
# Simulate data
dat = data.frame(
sid = 1:n,
age = rnorm(n, mean = 20, sd = 2),
prev_grade = runif(n, min = 0, max = 100),
transfer = rep(0:1, c(300, 200))
)
summary(dat)
###############################################
####### BEGIN INPUT: Random Assignment ########
###############################################
# Simple random assignment
dat$cond_simple = rbinom(n, size = 1, prob = 0.5)
hist(dat$cond_simple)
# Complete random assignment
dat$cond_complete = sample(rep(0:1, each = n/2))
# Blocked (on transfer status) random assignment
dat$cond_blocked = c(sample(rep(0:1, each = sum(dat$transfer == 0)/2)), sample(rep(0:1, each = sum(dat$transfer == 1)/2)))
###############################################
###############################################
###############################################
####### BEGIN INPUT: Check balance ############
###############################################
# Check assignment to condition
table(dat$cond_simple)
table(dat$cond_complete)
table(dat$cond_blocked)
# Check balance function
library(dplyr)
Balanced <- function (df, condition) {
df %>%
group_by_(condition) %>%
summarize(mean_age = mean(age),
var_age = var(age),
mean_grade = mean(prev_grade),
var_grade = var(prev_grade),
mean_transfer = mean(transfer),
var_transfer = mean(transfer) * (1 - mean(transfer))) %>%
data.frame(.) %>%
summarize(Effect_age = (.[.[, condition] == 1, 'mean_age'] - .[.[, condition] == 0, 'mean_age'])/sqrt((.[.[, condition] == 1, 'var_age'] + .[.[, condition] == 0, 'var_age'])/2),
Effect_grade = (.[.[, condition] == 1, 'mean_grade'] - .[.[, condition] == 0, 'mean_grade'])/sqrt((.[.[, condition] == 1, 'var_grade'] + .[.[, condition] == 0, 'var_grade'])/2),
Effect_transfer = (.[.[, condition] == 1, 'mean_transfer'] - .[.[, condition] == 0, 'mean_transfer'])/sqrt((.[.[, condition] == 1, 'var_transfer'] + .[.[, condition] == 0, 'var_transfer'])/2))
}
# Check balance: simple
Balanced(dat, 'cond_simple')
# Check balance: complete
Balanced(dat, 'cond_complete')
# Check balance: block
Balanced(dat, 'cond_blocked')
###############################################
###############################################
# grade = prev_grade + noise + treatment effect
dat$grade = dat$prev_grade + rnorm(nrow(dat), 0, 50) + dat$cond_simple * 20
dat$pass = as.numeric(dat$grade > 0)
###############################################
####### BEGIN INPUT: Perform analysis #########
###############################################
# t-test
t.test(grade ~ cond_simple, dat)
# Test of proportion
prop.test(table(dat$cond_simple, dat$pass), 500)
# Regression adjusting for prev grade
summary(lm(grade ~ cond_simple + prev_grade, dat))
# Wilcox test
wilcox.test(grade ~ cond_simple, dat)
###############################################
###############################################
###############################################
####### BEGIN INPUT: Stats for Report #########
###############################################
# Percentage change
(mean(dat[dat$cond_simple == 1, 'grade']) - mean(dat[dat$cond_simple == 0, 'grade']))/mean(dat[dat$cond_simple == 0, 'grade'])
# Cohen's d
(mean(dat[dat$cond_simple == 1, 'grade']) - mean(dat[dat$cond_simple == 0, 'grade']))/sqrt((var(dat[dat$cond_simple == 1, 'grade']) + var(dat[dat$cond_simple == 0, 'grade']))/2)
# Summary sentence
# None of the hypothesis tests conducted above produced a p-value less than 0.05, so we fail to reject the null hypothesis in each case that there is a difference in grades between students in the intervention and control groups in the population. There is a small percentage increase in grades of about 16.2% for the intervention group and Cohen's d is about 0.149, so the mean shifts about 0.149 standard deviations relative to the control group.
###############################################
###############################################
# grade = prev_grade + noise + treatment effect
set.seed(123)
dat$grade = dat$prev_grade + rnorm(nrow(dat), 0, 50) + dat$cond_simple * 20
dat$pass = as.numeric(dat$grade > 0)
###############################################
####### BEGIN INPUT: Perform analysis #########
###############################################
# t-test
t.test(grade ~ cond_simple, dat)
# Test of proportion
prop.test(table(dat$cond_simple, dat$pass), 500)
# Regression adjusting for prev grade
summary(lm(grade ~ cond_simple + prev_grade, dat))
# Wilcox test
wilcox.test(grade ~ cond_simple, dat)
###############################################
###############################################
# grade = prev_grade + noise + treatment effect
set.seed(11)
dat$grade = dat$prev_grade + rnorm(nrow(dat), 0, 50) + dat$cond_simple * 20
dat$pass = as.numeric(dat$grade > 0)
###############################################
####### BEGIN INPUT: Perform analysis #########
###############################################
# t-test
t.test(grade ~ cond_simple, dat)
# Test of proportion
prop.test(table(dat$cond_simple, dat$pass), 500)
# Regression adjusting for prev grade
summary(lm(grade ~ cond_simple + prev_grade, dat))
# Wilcox test
wilcox.test(grade ~ cond_simple, dat)
###############################################
###############################################
###############################################
####### BEGIN INPUT: Stats for Report #########
###############################################
# Percentage change
(mean(dat[dat$cond_simple == 1, 'grade']) - mean(dat[dat$cond_simple == 0, 'grade']))/mean(dat[dat$cond_simple == 0, 'grade'])
# Cohen's d
(mean(dat[dat$cond_simple == 1, 'grade']) - mean(dat[dat$cond_simple == 0, 'grade']))/sqrt((var(dat[dat$cond_simple == 1, 'grade']) + var(dat[dat$cond_simple == 0, 'grade']))/2)
# Summary sentence
# None of the hypothesis tests conducted above produced a p-value less than 0.05, so we fail to reject the null hypothesis in each case that there is a difference in grades between students in the intervention and control groups in the population. There is a small percentage increase in grades of about 21.8% for the intervention group and Cohen's d is about 0.211, so the mean shifts about 0.149 standard deviations relative to the control group.
###############################################
###############################################
# grade = prev_grade + noise + treatment effect
set.seed(11)
dat$grade = dat$prev_grade + rnorm(nrow(dat), 0, 50) + dat$cond_simple * 20
dat$pass = as.numeric(dat$grade > 0)
###############################################
####### BEGIN INPUT: Perform analysis #########
###############################################
# t-test
t.test(grade ~ cond_simple, dat)
# Test of proportion
prop.test(table(dat$cond_simple, dat$pass), 500)
# Regression adjusting for prev grade
summary(lm(grade ~ cond_simple + prev_grade, dat))
# Wilcox test
wilcox.test(grade ~ cond_simple, dat)
###############################################
###############################################
###############################################
####### BEGIN INPUT: Stats for Report #########
###############################################
# Percentage change
(mean(dat[dat$cond_simple == 1, 'grade']) - mean(dat[dat$cond_simple == 0, 'grade']))/mean(dat[dat$cond_simple == 0, 'grade'])
# Cohen's d
(mean(dat[dat$cond_simple == 1, 'grade']) - mean(dat[dat$cond_simple == 0, 'grade']))/sqrt((var(dat[dat$cond_simple == 1, 'grade']) + var(dat[dat$cond_simple == 0, 'grade']))/2)
# Summary sentence
# None of the hypothesis tests conducted above produced a p-value less than 0.05, so we fail to reject the null hypothesis in each case that there is a difference in grades between students in the intervention and control groups in the population. There is a small percentage increase in grades of about 21.8% for the intervention group and Cohen's d is about 0.211, so the mean shifts about 0.149 standard deviations relative to the control group.
###############################################
###############################################
###############################################
####### BEGIN INPUT: Stats for Report #########
###############################################
# Percentage change
(mean(dat[dat$cond_simple == 1, 'grade']) - mean(dat[dat$cond_simple == 0, 'grade']))
/mean(dat[dat$cond_simple == 0, 'grade'])
###############################################
####### BEGIN INPUT: Check balance ############
###############################################
# Check assignment to condition
table(dat$cond_simple)
table(dat$cond_complete)
table(dat$cond_blocked)
# Check balance function
library(dplyr)
Balanced <- function (df, condition) {
df %>%
group_by_(condition) %>%
summarize(mean_age = mean(age),
var_age = var(age),
mean_grade = mean(prev_grade),
var_grade = var(prev_grade),
mean_transfer = mean(transfer),
var_transfer = mean(transfer) * (1 - mean(transfer))) %>%
data.frame(.) %>%
summarize(Effect_age = (.[.[, condition] == 1, 'mean_age']
- .[.[, condition] == 0, 'mean_age'])
/sqrt((.[.[, condition] == 1, 'var_age']
+ .[.[, condition] == 0, 'var_age'])/2),
Effect_grade = (.[.[, condition] == 1, 'mean_grade']
- .[.[, condition] == 0, 'mean_grade'])
/sqrt((.[.[, condition] == 1, 'var_grade']
+ .[.[, condition] == 0, 'var_grade'])/2),
Effect_transfer = (.[.[, condition] == 1, 'mean_transfer']
- .[.[, condition] == 0, 'mean_transfer'])
/sqrt((.[.[, condition] == 1, 'var_transfer']
+ .[.[, condition] == 0, 'var_transfer'])/2))
}
# Check balance: simple
Balanced(dat, 'cond_simple')
# Check balance: complete
Balanced(dat, 'cond_complete')
# Check balance: block
Balanced(dat, 'cond_blocked')
###############################################
###############################################
###############################################
####### BEGIN INPUT: Stats for Report #########
###############################################
# Percentage change
(mean(dat[dat$cond_simple == 1, 'grade']) - mean(dat[dat$cond_simple == 0, 'grade']))
/(mean(dat[dat$cond_simple == 0, 'grade']))
###############################################
####### BEGIN INPUT: Stats for Report #########
###############################################
# Percentage change
(mean(dat[dat$cond_simple == 1, 'grade'])
- mean(dat[dat$cond_simple == 0, 'grade']))/mean(dat[dat$cond_simple == 0, 'grade'])
# Cohen's d
(mean(dat[dat$cond_simple == 1, 'grade']) - mean(dat[dat$cond_simple == 0, 'grade']))
/sqrt((var(dat[dat$cond_simple == 1, 'grade']) + var(dat[dat$cond_simple == 0, 'grade']))/2)
###############################################
####### BEGIN INPUT: Stats for Report #########
###############################################
# Percentage change
(mean(dat[dat$cond_simple == 1, 'grade'])
- mean(dat[dat$cond_simple == 0, 'grade']))/mean(dat[dat$cond_simple == 0, 'grade'])
# Cohen's d
(mean(dat[dat$cond_simple == 1, 'grade'])
- mean(dat[dat$cond_simple == 0, 'grade']))/sqrt((var(dat[dat$cond_simple == 1, 'grade'])
+ var(dat[dat$cond_simple == 0, 'grade']))/2)
# Summary sentence
# All of the hypothesis tests conducted above produced a p-value less than 0.05, so we
# reject the null hypothesis in each case that there is no difference in grades between
# students in the intervention and control groups in the population. There is a
# moderate-large effect of condition on grade with a percentage increase in grades of
# about 55.8.8% for the intervention group and a Cohen's d of about 0.449.
###############################################
###############################################
